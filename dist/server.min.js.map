{"version":3,"sources":["server.js"],"names":["express","require","app","body","validationResult","port","process","env","PORT","set","use","bodyParser","json","urlencoded","extended","connectionParams","DATABASE_URL","connectionString","Pool","ssl","rejectUnauthorized","database","user","password","req","res","console","log","get","pool","query","err","version_results","rows","team_members_results","teamNumber","version","teamMembers","post","isAlpha","withMessage","min","isLength","isEmpty","errors","status","send","array","redirect","first_name","last_name","result","module","exports"],"mappings":"aAAA,IAAMA,QAAUC,QAAQ,WAClBC,IAAMF,UADNA,WAAUC,QAAQ,wBAGWA,QAAQ,qBAAnCE,cAAAA,KAAMC,0BAAAA,iBAERC,KAAOC,QAAQC,IAAIC,MAAQ,IAGjCN,IAAIO,IAAI,cALmC,OAQ3CP,IAAIQ,IAAIC,WAAWC,QAHnBV,IAAIO,IAAIE,WAAAE,WAMsB,CAJ9BC,UAAA,KAIAZ,IAAIQ,KAAIC,QAAWE,MAAAA,KAMfE,iBALJ,KAOIA,iBALJ,MAAAT,QAAAC,IAAAS,aAKuB,CAJbC,iBAAiBC,QAA3BX,IAAAS,aAMQG,IAAK,CAAEC,oBAAoB,IAHnBJ,CACZD,KAAAA,WACIE,KAAAA,YACGI,SAAE,MAAED,SAAAA,WAAFf,KAAA,MAGTU,QAAAA,IAAAA,kBACIO,IAAAA,KAAM,IAAAJ,KADSH,kBAIfQ,IAAAA,IAAAA,IAAQ,SAAEC,EAAAC,GAJKC,QAAnBC,IAAA,WAAAH,EAAAI,IAAA,WAgBFC,KAAKC,MAAM,mBAAoB,SAACC,EAAKC,GARvCN,QAAYX,IAAAA,EAAAA,EAAZkB,MAIIL,KAAIE,MAAK,6BAAc,SAAAC,EAAAG,GAEzBR,QAAYC,IAAAI,EAAAG,GAGVR,EAAAA,OAAYK,QAAKC,CAENG,WAAA,EACQD,gBAAjBF,EAAAC,KAAA,GAAAG,QAEoBC,YAAAH,EAAAD,OAGEI,QAAAA,IAAAA,iBAAaH,EAAoBN,IAACK,uBAM7D/B,IAnBDoC,KAAA,IAqBApC,KAAIoC,cAGeC,UACdC,SAHH,CAGeC,IAAA,IAGED,YAAE,iBAFnBrC,KAGGqC,aAGHD,UAJGG,SAAS,CAAED,IAAK,IAKnBD,YAAYG,iBACV,SAAAnB,EAAAC,GAA4B,IAA5BmB,EAAAxC,iBAAAoB,GACD,IAAAoB,EAAAD,UADC,OAAOlB,EAAIoB,OAAO,KAAKC,KAAK,CAAEF,OAAQA,EAAOG,UAOzCtB,KAAIuB,MAAJvB,6DAAAA,OAAAD,EAAArB,KAAA8C,WAAAxB,QAAAA,OAAAD,EAAArB,KAAA+C,UAAAzB,MAAA,SAAAM,EAAAoB,GApBRzB,QAAAC,IAAAI,EAAAoB,GAoBQ1B,EAAIuB,SAAS,SAIrBI,OAAOC,QAAUnD","file":"server.min.js","sourcesContent":["const express = require('express')\r\nconst app = express();\r\nconst bodyParser = require('body-parser');\r\nconst { body, validationResult } = require('express-validator');\r\n\r\nconst port = process.env.PORT || 3000\r\n\r\n// Set the view engine for the express app\r\napp.set(\"view engine\", \"pug\")\r\n\r\n// for parsing application/json\r\napp.use(bodyParser.json());\r\n\r\n// for parsing application/xwww-\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\n//form-urlencoded\r\n\r\n// Database\r\nconst Pool = require('pg').Pool\r\n\r\nvar connectionParams = null;\r\nif (process.env.DATABASE_URL != null) {\r\n    connectionParams = {\r\n        connectionString: process.env.DATABASE_URL,\r\n        ssl: { rejectUnauthorized: false }\r\n    }\r\n} else {\r\n    connectionParams = {\r\n        user: 'api_user',\r\n        host: 'localhost',\r\n        database: 'api',\r\n        password: 'password',\r\n        port: 5432\r\n    }\r\n}\r\nconsole.log(connectionParams)\r\nconst pool = new Pool(connectionParams)\r\n\r\n\r\napp.get('/', (req, res) => {\r\n\r\n  console.log('Accept: ' + req.get('Accept'))\r\n\r\n  pool.query('SELECT VERSION()', (err, version_results) => {\r\n    console.log(err, version_results.rows)\r\n\r\n    pool.query('SELECT * FROM team_members', (err, team_members_results) => {\r\n      console.log(err, team_members_results)\r\n\r\n      res.render('index', {\r\n                            teamNumber: 5,\r\n                            databaseVersion: version_results.rows[0].version,\r\n                            teamMembers: team_members_results.rows\r\n                          })\r\n\r\n      console.log('Content-Type: ' + res.get('Content-Type'))\r\n    })\r\n  })\r\n})\r\n\r\napp.post('/', \r\n  body('first_name')\r\n    .isAlpha()\r\n    .isLength({ min: 1})\r\n    .withMessage('must be valid'),\r\n  body('last_name')\r\n    .isAlpha()\r\n    .isLength({ min: 0 })\r\n    .withMessage('must be valid'),\r\n(req, res) => {\r\n\r\n  const errors = validationResult(req);\r\n  if (!errors.isEmpty()) {\r\n    return res.status(400).send({ errors: errors.array() });\r\n  }\r\n\r\n    pool.query(`INSERT INTO team_members (first_name, last_name) VALUES ('${req.body.first_name}', '${req.body.last_name}')`, (err, result) => {\r\n\r\n        console.log(err, result)\r\n\r\n        res.redirect('/')\r\n    })\r\n  })\r\n\r\nmodule.exports = app;"]}